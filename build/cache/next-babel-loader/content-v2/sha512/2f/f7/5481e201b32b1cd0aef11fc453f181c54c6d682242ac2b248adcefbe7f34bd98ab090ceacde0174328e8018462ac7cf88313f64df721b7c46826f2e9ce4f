{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Row, Col, Typography, Button, Table, message, Drawer } from \"antd\";\nimport React from \"react\";\nimport { HomeFilled, ClockCircleOutlined, InfoCircleFilled, DeleteFilled } from \"@ant-design/icons\";\nimport { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport Link from \"next/link\";\nimport { asyncLocalStorage } from \"../../../utils/localStorage\";\nimport { getPlateByID } from \"../../../redux/actions/food\";\nimport { getUserBasket, increaseItemToCart, decreaseItemToCart, removeInCart } from \"../../../redux/actions/cart/cartAction\";\nimport { VscLoading } from \"react-icons/vsc\";\nimport { session, useSession } from \"next-auth/client\";\nimport LoginPage1 from \"../../Layouts/Header/Login/LoginPage1\";\nimport LoginPage2 from \"../../Layouts/Header/Login/LoginPage2\";\nimport { useRouter } from 'next/router';\nconst {\n  Text\n} = Typography;\n\nconst ClockIcon = () => {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/clock.png\",\n    className: \"w-3 h-3\",\n    alt: \"clock\"\n  });\n};\n\nconst TruckIcon = () => {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/truck.png\",\n    alt: \"truck\",\n    className: \"h-3 w-auto\"\n  });\n};\n\nconst CartIcon = () => {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/cart.png\",\n    alt: \"cart\",\n    className: \"w-4 h-4\"\n  });\n};\n\nconst StarIcon = () => {\n  return /*#__PURE__*/_jsx(\"img\", {\n    className: \"w-3 h-3\",\n    src: \"/images/star-yellow.png\",\n    alt: \"rating\"\n  });\n};\n\nconst Item = ({\n  price,\n  name,\n  orderCount,\n  plateID,\n  basketItemId\n}) => {\n  const [session, loading] = useSession();\n  const dispatch = useDispatch();\n  const {\n    0: quantity,\n    1: setQuantity\n  } = useState(orderCount);\n  const router = useRouter();\n  console.log(\"router\");\n  console.log(router.pathname);\n\n  const updateDOM = async (basketItemId, plateId, type) => {\n    let cartitems = await asyncLocalStorage.getItem(\"cartitems\");\n    cartitems = JSON.parse(cartitems)[\"items\"];\n\n    if (cartitems.length > 0) {\n      cartitems.forEach(item => {\n        if (item[\"plateId\"] == plateId) {\n          console.log(\"found\");\n\n          if (type === \"add\") {\n            item[\"ordered\"] = item[\"ordered\"] + 1;\n          } else {\n            item[\"ordered\"] = item[\"ordered\"] - 1;\n          }\n\n          console.log(item);\n        }\n      });\n      console.log(cartitems);\n      await asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n        items: cartitems\n      }));\n      console.log(\"items set\");\n\n      if (session) {\n        let deliveryType = \"user\";\n\n        if (type === \"add\") {\n          await dispatch(increaseItemToCart(basketItemId, deliveryType));\n        } else {\n          await dispatch(decreaseItemToCart(basketItemId, deliveryType));\n        }\n      }\n\n      window.location.reload();\n    }\n  };\n\n  const AddOne = (basketItemId, plateID) => {\n    console.log(\"AddOne\");\n    console.log(quantity);\n\n    if (quantity < 10) {\n      setQuantity(quantity + 1);\n      updateDOM(basketItemId, plateID, \"add\");\n    }\n  };\n\n  const removeOne = (basketItemId, plateID) => {\n    console.log(\"removeOne\");\n    console.log(quantity);\n\n    if (quantity > 1) {\n      setQuantity(quantity - 1);\n      updateDOM(basketItemId, plateID, \"remove\");\n    }\n  };\n\n  const removeItemInCart = async (basketItemId, plateID) => {\n    let deliveryType = \"user\";\n    await dispatch(removeInCart(basketItemId, deliveryType, plateID));\n    let cartitems = await asyncLocalStorage.getItem(\"cartitems\");\n    cartitems = JSON.parse(cartitems)[\"items\"];\n    cartitems = cartitems.filter(e => e.plateId.toString() !== plateID.toString());\n\n    if (cartitems.length > 0) {\n      await asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n        items: cartitems\n      }));\n    } else {\n      await asyncLocalStorage.removeItem(\"cartitems\");\n    } // setCartData(cartitems);\n\n\n    window.location.reload();\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsxs(Row, {\n      gutter: 2,\n      className: \"py-4 px-2 items-center\",\n      children: [/*#__PURE__*/_jsxs(Col, {\n        span: 16,\n        className: \"flex items-center\",\n        children: [/*#__PURE__*/_jsx(DeleteFilled, {\n          onClick: () => removeItemInCart(basketItemId, plateID),\n          className: \"mr-3 text-lg pb-1 cursor-pointer\"\n        }), /*#__PURE__*/_jsx(\"p\", {\n          children: name\n        })]\n      }), /*#__PURE__*/_jsx(Col, {\n        md: 3,\n        lg: 2,\n        span: 4,\n        className: \"lg:ml-auto py-1 border-b-2 border-gray-400 bg-gray-300\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center justify-center\",\n          children: [/*#__PURE__*/_jsx(\"button\", {\n            onClick: () => AddOne(basketItemId, plateID),\n            children: \"+\"\n          }), /*#__PURE__*/_jsx(\"p\", {\n            className: \"mx-2\",\n            children: orderCount\n          }), /*#__PURE__*/_jsx(\"button\", {\n            onClick: () => removeOne(basketItemId, plateID),\n            children: \"-\"\n          })]\n        })\n      }), /*#__PURE__*/_jsxs(Col, {\n        span: 2,\n        className: \"text-right ml-auto\",\n        children: [\"$ \", price]\n      })]\n    })]\n  });\n};\n\nfunction Cart() {\n  const [session, loading] = useSession();\n  const dispatch = useDispatch();\n  const {\n    0: data,\n    1: setData\n  } = useState([]);\n  const {\n    0: isCart,\n    1: setisCart\n  } = useState(false);\n  const {\n    0: sessionFlag,\n    1: setSessionFlag\n  } = useState(false);\n  const {\n    0: total,\n    1: setTotal\n  } = useState(0.0);\n  const {\n    0: isMobile,\n    1: setIsMobile\n  } = useState(false);\n  const {\n    0: visible,\n    1: setVisible\n  } = useState(false);\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    customer: \"\",\n    page1: true,\n    page2: false\n  });\n\n  const moveToPage2 = () => {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      page1: false,\n      page2: true\n    }));\n  };\n\n  const goToPage1 = () => {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      page1: true,\n      page2: false\n    }));\n  };\n\n  const onClose = () => {\n    setTimeout(() => {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        page1: true,\n        page2: false\n      }));\n    }, 500);\n    setVisible(false);\n  };\n\n  useEffect(async () => {\n    window.screen.width < 780 ? setIsMobile(true) : setIsMobile(false);\n\n    if (!isCart) {\n      let cartitems = await asyncLocalStorage.getItem(\"cartitems\");\n      cartitems = JSON.parse(cartitems);\n\n      if (cartitems) {\n        let deliveryType = \"user\"; //get basket items here\n\n        if (session) {\n          let basketData = await dispatch(getUserBasket(deliveryType));\n          setData(data => basketData.items);\n          setTotal(total => basketData.total);\n          setSessionFlag(true);\n        } else {\n          for (const itemKey in cartitems[\"items\"]) {\n            const item = cartitems[\"items\"][itemKey];\n            const plateId = item[\"plateId\"];\n            let plateData = await dispatch(getPlateByID(plateId));\n            const plateDataToPush = {\n              plate_id: plateId,\n              count: item[\"ordered\"],\n              plate_name: plateData.data.name,\n              plate_price: (plateData.data.price * item[\"ordered\"]).toFixed(2)\n            };\n            console.log(\"Pushded\", plateDataToPush); // console.log(data)\n\n            console.log(total + plateData.data.price * item[\"ordered\"]);\n            setTotal(total => total + plateData.data.price * item[\"ordered\"]);\n            setData(data => [...data, plateDataToPush]);\n          }\n\n          setSessionFlag(false);\n        }\n      }\n\n      setisCart(true);\n    }\n  }, []);\n\n  const setCartData = async cartitems => {\n    for (const itemKey in cartitems[\"items\"]) {\n      const item = cartitems[\"items\"][itemKey];\n      const plateId = item[\"plateId\"];\n      let plateData = await dispatch(getPlateByID(plateId));\n      const plateDataToPush = {\n        plate_id: plateId,\n        count: item[\"ordered\"],\n        plate_name: plateData.data.name,\n        plate_price: (plateData.data.price * item[\"ordered\"]).toFixed(2)\n      };\n      console.log(\"Pushded\", plateDataToPush); // console.log(data)\n\n      console.log(total + plateData.data.price * item[\"ordered\"]);\n      setTotal(total => total + plateData.data.price * item[\"ordered\"]);\n      setData(data => [...data, plateDataToPush]);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"cart-banner\",\n      children: [/*#__PURE__*/_jsx(Row, {\n        className: \"mt-20 pt-2 pb-4 mx-auto w-3/5\",\n        align: \"middle\",\n        children: /*#__PURE__*/_jsxs(Col, {\n          span: 24,\n          className: \"flex justify-start items-center\",\n          children: [/*#__PURE__*/_jsx(HomeFilled, {}), /*#__PURE__*/_jsx(Text, {\n            strong: true,\n            className: \"text-black ml-4\",\n            children: \"Cart\"\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"w-full bg-fixed bg-cover bg-no-repeat bg-center relative\",\n        style: {\n          backgroundImage: \"url(/images/cartbg.jpg)\",\n          height: \"40vh\",\n          backgroundSize: \"100%\",\n          filter: \"brightness(50%)\"\n        },\n        justify: \"center\",\n        align: \"middle\"\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"absolute w-full\",\n        style: {\n          height: \"40vh\",\n          transform: \"translateY(-100%)\"\n        },\n        justify: \"center\",\n        align: \"middle\",\n        children: /*#__PURE__*/_jsx(Col, {\n          children: /*#__PURE__*/_jsx(Text, {\n            strong: true,\n            className: \"block text-white text-3xl\",\n            children: \"Cart\"\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"cart-main lg:px-36 md:px-20 px-2 py-20\",\n      children: [/*#__PURE__*/_jsx(Text, {\n        className: \"lg:px-36 md:px-20 px-2 text-2xl\",\n        strong: true,\n        children: \"Items\"\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"lg:px-36 md:px-20 px-2 py-4\",\n        children: isCart === true && data.length > 0 ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [session && sessionFlag ? /*#__PURE__*/_jsx(_Fragment, {\n            children: data.map((basket, index) => {\n              return /*#__PURE__*/_jsx(Item, {\n                basketItemId: basket.basketItemId,\n                plateID: basket.plate.id,\n                name: basket.plate.name,\n                price: basket.total_value,\n                orderCount: basket.quantity\n              }, index);\n            })\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: data.map((plate_data, index) => {\n              return /*#__PURE__*/_jsx(Item, {\n                plateID: plate_data[\"plate_id\"],\n                name: plate_data[\"plate_name\"],\n                price: plate_data[\"plate_price\"],\n                orderCount: plate_data[\"count\"]\n              }, index);\n            })\n          }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsx(\"div\", {\n            className: \"py-4 cart-info \",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex cart-info justify-between pt-1\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"cart-total order-last\",\n                children: /*#__PURE__*/_jsxs(\"p\", {\n                  className: \"font-semibold text-base\",\n                  children: [\"$\", total]\n                })\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                className: \"font-semibold text-lg\",\n                children: [\"Subtotal\", /*#__PURE__*/_jsxs(\"p\", {\n                  className: \"flex items-center text-xs\",\n                  children: [/*#__PURE__*/_jsx(InfoCircleFilled, {\n                    className: \"mr-1 text-red-500\"\n                  }), \" Extra charges may apply\"]\n                })]\n              })]\n            })\n          }), session ? /*#__PURE__*/_jsx(_Fragment, {\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"flex flex-row-reverse checkout-btn\",\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: \"py-4 px-10 text-center bg-red-500 text-white font-semibold\",\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/payments\",\n                  children: /*#__PURE__*/_jsx(\"a\", {\n                    children: \" Checkout \\u2192\"\n                  })\n                })\n              })\n            })\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"flex flex-row-reverse checkout-btn\",\n              onClick: () => setVisible(true),\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: \"py-4 px-10 text-center bg-red-500 text-white font-semibold\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \" Checkout \\u2192\"\n                })\n              })\n            })\n          }), /*#__PURE__*/_jsxs(Drawer, {\n            destroyOnClose: true,\n            placement: \"left\",\n            closable: false,\n            onClose: onClose,\n            visible: visible,\n            width: isMobile ? \"100%\" : \"35%\",\n            drawerStyle: {\n              width: \"83%\",\n              marginLeft: \"auto\",\n              marginRight: \"auto\"\n            },\n            keyboard: true,\n            children: [state.page1 && /*#__PURE__*/_jsx(LoginPage1, {\n              onClick: () => setVisible(false),\n              onPartnerSignInClick: moveToPage2,\n              onUserSignInClick: moveToPage2\n            }), state.page2 && /*#__PURE__*/_jsx(LoginPage2, {\n              onClick: onClose,\n              goBack: goToPage1,\n              customer: state.customer\n            })]\n          })]\n        }) : /*#__PURE__*/_jsx(_Fragment, {\n          children: isCart && data.length < 1 ? /*#__PURE__*/_jsxs(\"p\", {\n            className: \"text-center text-3xl py-6\",\n            children: [\"Your Cart is empty\", /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                className: \"block text-xl pt-4\",\n                children: \"Goto Home \\u2192\"\n              })\n            })]\n          }) : /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex pt-20 flex-col items-center justify-center\",\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: \"text-3xl\",\n              children: \"Loading\"\n            }), /*#__PURE__*/_jsx(VscLoading, {\n              className: \"text-4xl animate-spin\"\n            })]\n          })\n        })\n      })]\n    })]\n  });\n}\n\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}