{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { Component, useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { Menu, Dropdown, Button, Drawer, Badge } from \"antd\";\nimport { signOut, useSession } from \"next-auth/client\";\nimport { DownOutlined } from \"@ant-design/icons\";\nimport { FaUser } from \"react-icons/fa\";\nimport Signup from \"./Signup/Signup\";\nimport Login from \"./Login/Login\";\nimport LeftMenu from \"../menu/LeftMenu\";\nimport { FaShoppingBag } from \"react-icons/fa\";\nimport { asyncLocalStorage } from \"../../../utils/localStorage\";\nimport { useLocalStorageState } from \"ahooks\";\nimport { connect, useSelector, useDispatch } from \"react-redux\";\nimport { setCartItems, setCartItemsWithSessionFlag, setCartItemsWithoutSessionFlag, getUserBasket, addItemsToCart } from \"../../../redux/actions/cart/cartAction\";\nimport PredictionsOnInputChange from \"../../auto-complete/index\";\n\nvar FoodHeader = function FoodHeader(_ref) {\n  var cart = _ref.cart;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 2),\n      session = _useSession2[0],\n      loading = _useSession2[1];\n\n  var _useState = useState(\"\"),\n      searchValue = _useState[0],\n      _setSearchValue = _useState[1];\n\n  var _useState2 = useState(0),\n      cartCount = _useState2[0],\n      setCartCount = _useState2[1];\n\n  var _useState3 = useState([]),\n      basketItems = _useState3[0],\n      setBasketItems = _useState3[1];\n\n  var isChef = (session === null || session === void 0 ? void 0 : session.role) === \"chef\";\n  var isDriver = (session === null || session === void 0 ? void 0 : session.role) === \"driver\";\n  var isUser = (session === null || session === void 0 ? void 0 : session.role) === \"user\";\n\n  var _useLocalStorageState = useLocalStorageState(\"cartitems\"),\n      _useLocalStorageState2 = _slicedToArray(_useLocalStorageState, 2),\n      items = _useLocalStorageState2[0],\n      setItems = _useLocalStorageState2[1];\n\n  var dispatch = useDispatch();\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var localBasketItems, platesArray, cartItemsArray, deliveryType, userBasketItemsBefore, reqBasket, userBasketItemsAfter;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            console.log(\"SESSION: ==>>\");\n            console.log(session);\n            localBasketItems = items ? items[\"items\"] : [];\n            platesArray = [];\n            cartItemsArray = [];\n            deliveryType = \"user\";\n\n            if (!session) {\n              _context.next = 34;\n              break;\n            }\n\n            if (cart.cartItemSetWithSessionFlag) {\n              _context.next = 32;\n              break;\n            }\n\n            console.log(\"1\");\n            _context.next = 12;\n            return dispatch(getUserBasket(deliveryType));\n\n          case 12:\n            userBasketItemsBefore = _context.sent;\n            //\n            localBasketItems.map(function (item) {\n              console.log(\"2\");\n\n              if (!userBasketItemsBefore.items.some(function (basket) {\n                return basket.plate.id.toString() === item.plateId.toString();\n              })) {\n                console.log(\"not match: \" + item.plateId);\n                platesArray.push({\n                  quantity: 1,\n                  plateId: item.plateId,\n                  note: \"Special Instructions goes here\"\n                });\n              }\n            });\n            console.log(\"3\");\n\n            if (!(platesArray.length > 0)) {\n              _context.next = 20;\n              break;\n            }\n\n            reqBasket = {\n              deliveryType: \"user\",\n              plates: platesArray\n            };\n            console.log(\"4\");\n            _context.next = 20;\n            return dispatch(addItemsToCart(reqBasket));\n\n          case 20:\n            _context.next = 22;\n            return dispatch(getUserBasket(deliveryType));\n\n          case 22:\n            userBasketItemsAfter = _context.sent;\n            console.log(\"5\");\n            console.log(userBasketItemsAfter); // if both basket is not empty\n\n            userBasketItemsAfter.items.map(function (item) {\n              console.log(\"6\");\n              cartItemsArray.push({\n                ordered: item.quantity,\n                plateId: item.plate.id\n              });\n            });\n            console.log(\"7\");\n            _context.next = 29;\n            return asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n              items: cartItemsArray\n            }));\n\n          case 29:\n            dispatch(setCartItems(cartItemsArray));\n            dispatch(setCartItemsWithSessionFlag());\n            console.log(\"8\");\n\n          case 32:\n            _context.next = 35;\n            break;\n\n          case 34:\n            if (!cart.cartItemSetWithoutSessionFlag) {\n              dispatch(setCartItems(localBasketItems));\n              dispatch(setCartItemsWithoutSessionFlag());\n            }\n\n          case 35:\n            console.log(\"9\");\n            setCartCount(cart.itemCount);\n            _context.next = 42;\n            break;\n\n          case 39:\n            _context.prev = 39;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 42:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 39]]);\n  })), [cart, session]);\n\n  var DropdownMobile = function DropdownMobile() {\n    return /*#__PURE__*/_jsxs(Menu, {\n      className: \"mt-4\",\n      children: [/*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: !session ? /*#__PURE__*/_jsx(Signup, {\n          isMobile: true\n        }) : /*#__PURE__*/_jsx(Link, {\n          href: \"\".concat(isChef ? \"/chef\" : isDriver ? \"/driver\" : \"/user\"),\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Dashboard\"\n          })\n        })\n      }, \"0\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: !session ? /*#__PURE__*/_jsx(Login, {\n          isMobile: true\n        }) : /*#__PURE__*/_jsx(Link, {\n          href: \"\".concat(isChef ? \"/chef/profile\" : isDriver ? \"/driver/profile\" : \"/user/profile\"),\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-8 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Profile\"\n          })\n        })\n      }, \"1\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/about\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n            children: \"About\"\n          })\n        })\n      }, \"2\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/contact\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n            children: \"Contact us\"\n          })\n        })\n      }, \"3\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/cart\",\n          children: /*#__PURE__*/_jsxs(\"p\", {\n            className: \"cursor-pointer flex items-center\",\n            children: [\"Cart (\", cartCount, \")\"]\n          })\n        })\n      }, \"4\"), session ? /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(\"a\", {\n          href: \"#\",\n          className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n          role: \"menuitem\",\n          onClick: function onClick(e) {\n            e.preventDefault();\n            signOut({\n              callbackUrl: \"/\"\n            });\n          },\n          children: \"Sign out\"\n        })\n      }, \"4\") : null]\n    });\n  };\n\n  var ImgIcon = function ImgIcon() {\n    // console.log(session.user.image)\n    if (session.user.image == \"null\") {\n      return /*#__PURE__*/_jsx(FaUser, {\n        className: \"text-2xl h-8 w-8 rounded-full mr-2\"\n      });\n    } else {\n      return /*#__PURE__*/_jsx(\"img\", {\n        src: session.user.image,\n        className: \"user-img h-8 w-8 rounded-full mr-6\",\n        alt: \"\"\n      });\n    }\n\n    return /*#__PURE__*/_jsx(FaUser, {});\n  };\n\n  var DropdownMenu = function DropdownMenu() {\n    return /*#__PURE__*/_jsxs(Menu, {\n      className: \"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5\",\n      children: [/*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"\".concat(isChef ? \"/chef\" : isDriver ? \"/driver\" : \"/#\"),\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Dashboard\"\n          })\n        })\n      }, \"0\"), /*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"\".concat(isChef ? \"/chef/profile\" : isDriver ? \"/driver/profile\" : \"/user/profile\"),\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Profile\"\n          })\n        })\n      }, \"1\"), /*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(\"a\", {\n          href: \"#\",\n          className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n          role: \"menuitem\",\n          onClick: function onClick(e) {\n            e.preventDefault();\n            signOut({\n              callbackUrl: \"/\"\n            });\n          },\n          children: \"Sign out\"\n        })\n      }, \"2\")]\n    });\n  };\n\n  return session ? /*#__PURE__*/_jsx(\"nav\", {\n    style: {\n      backgroundColor: \"#F7FCFF\",\n      boxShadow: \"0 0 5px #ddd\"\n    },\n    className: \"dark:bg-gray-800 stickey\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"mx-auto py-4\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:flex md:items-center md:justify-between\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex justify-between items-center px-8 md:px-0\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:block\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:flex cursor-pointer red pl-12\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"md:hidden cursor-pointer red\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/mobile-logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex md:hidden\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex flex-col -mx-4 md:flex-row md:items-center md:mx-8\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/about\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \"About\"\n                })\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"/contact\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n                  children: \"Contact us\"\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"mr-32 w-52\",\n              children: /*#__PURE__*/_jsx(PredictionsOnInputChange, {\n                searchValue: searchValue,\n                setSearchValue: function setSearchValue(e) {\n                  return _setSearchValue(e);\n                },\n                onChange: function onChange(value) {\n                  _setSearchValue(value);\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex items-center\",\n              children: [/*#__PURE__*/_jsx(Badge, {\n                count: cartCount,\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/cart\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: \"cursor-pointer flex items-center\",\n                    children: /*#__PURE__*/_jsx(FaShoppingBag, {\n                      className: \"text-2xl\"\n                    })\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Dropdown, {\n                className: \"flex flex-row justify-center items-center mt-4 md:mt-0\",\n                overlay: DropdownMenu,\n                trigger: [\"click\"],\n                placement: \"bottomRight\",\n                children: /*#__PURE__*/_jsxs(Button, {\n                  style: {\n                    backgroundColor: \"transparent\"\n                  },\n                  className: \"px-6 flex flex-row justify-center items-center\",\n                  type: \"text\",\n                  icon: /*#__PURE__*/_jsx(ImgIcon, {}),\n                  children: [session.user.name, \" \", /*#__PURE__*/_jsx(DownOutlined, {\n                    className: \"ml-2\"\n                  })]\n                })\n              })]\n            })]\n          })\n        })]\n      })\n    })\n  }) : /*#__PURE__*/_jsx(\"nav\", {\n    style: {\n      backgroundColor: \"#F7FCFF\",\n      boxShadow: \"0 0 5px #ddd\"\n    },\n    className: \"dark:bg-gray-800 stickey\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"mx-auto py-4\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:flex md:items-center md:justify-between\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex justify-between items-center px-8 md:px-0\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:block\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:flex cursor-pointer red pl-8\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"md:hidden cursor-pointer red\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/mobile-logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex md:hidden\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex flex-col -mx-4 md:flex-row md:items-center md:mx-8\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/about\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \"About\"\n                })\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"/contact\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n                  children: \"Contact us\"\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"mr-32 w-52\",\n              children: /*#__PURE__*/_jsx(PredictionsOnInputChange, {\n                searchValue: searchValue,\n                setSearchValue: function setSearchValue(e) {\n                  return _setSearchValue(e);\n                },\n                onChange: function onChange(value) {\n                  _setSearchValue(value);\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex items-center mt-4 md:mt-0\",\n              children: [/*#__PURE__*/_jsx(Badge, {\n                count: cartCount,\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/cart\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: \"cursor-pointer\",\n                    children: /*#__PURE__*/_jsx(FaShoppingBag, {\n                      className: \"text-2xl\"\n                    })\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Signup, {}), /*#__PURE__*/_jsx(Login, {})]\n            })]\n          })\n        })]\n      })\n    })\n  });\n};\n\nvar mapToProps = function mapToProps(state) {\n  // console.log(state)\n  return {\n    cart: state.cart\n  };\n};\n\nexport default connect(mapToProps)(FoodHeader);","map":null,"metadata":{},"sourceType":"module"}