{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport jwt_decode from 'jwt-decode';\nimport axiosClient from '../../../utils/axios-config';\nimport * as types from './authType';\nimport { asyncLocalStorage } from '../../../utils/localStorage';\nimport config from '../../../config';\nexport function userLogin(params) {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var res, decoded;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch({\n                type: types.AUTH_LOGIN_REQUEST\n              });\n              _context.prev = 1;\n              _context.next = 4;\n              return axiosClient.post('user/login', params, {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 4:\n              res = _context.sent;\n              decoded = jwt_decode(res.token);\n              console.log(res);\n              dispatch({\n                type: types.AUTH_LOGIN_SUCCESS,\n                payload: decoded\n              });\n              return _context.abrupt(\"return\", res);\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](1);\n              //console.log('error', error);\n              dispatch({\n                type: types.AUTH_LOGIN_FAILURE\n              });\n              return _context.abrupt(\"return\", Promise.reject(_context.t0));\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 11]]);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n}\nexport function userLoginSocial(params) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch) {\n      var res, decoded;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              dispatch({\n                type: types.AUTH_LOGIN_REQUEST\n              });\n              _context2.prev = 1;\n              _context2.next = 4;\n              return axiosClient.post('user/socialauth', params, {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 4:\n              res = _context2.sent;\n              decoded = jwt_decode(res.token);\n              console.log(res);\n              dispatch({\n                type: types.AUTH_LOGIN_SUCCESS,\n                payload: decoded\n              });\n              return _context2.abrupt(\"return\", res);\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](1);\n              //console.log('error', error);\n              dispatch({\n                type: types.AUTH_LOGIN_FAILURE\n              });\n              return _context2.abrupt(\"return\", Promise.reject(_context2.t0));\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 11]]);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n}\nexport function userSignup(parms) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch) {\n      var res, status;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              dispatch({\n                type: types.AUTH_SIGNUP_REQUEST\n              });\n              _context3.prev = 1;\n              console.log(parms);\n              _context3.next = 5;\n              return axiosClient.post('user/complete-registration', parms, {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 5:\n              res = _context3.sent;\n              // console.log(res)\n              status = res.status;\n\n              if (!(status == 201)) {\n                _context3.next = 12;\n                break;\n              }\n\n              dispatch({\n                type: types.AUTH_SIGNUP_SUCCESS,\n                payload: res.result.name\n              });\n              return _context3.abrupt(\"return\", res.status);\n\n            case 12:\n              dispatch({\n                type: types.AUTH_SIGNUP_FAILURE\n              });\n              return _context3.abrupt(\"return\", Promise.reject(e));\n\n            case 14:\n              _context3.next = 20;\n              break;\n\n            case 16:\n              _context3.prev = 16;\n              _context3.t0 = _context3[\"catch\"](1);\n              dispatch({\n                type: types.AUTH_SIGNUP_FAILURE\n              });\n              return _context3.abrupt(\"return\", Promise.reject(_context3.t0));\n\n            case 20:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 16]]);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n}\nexport function saveTokens(_x4) {\n  return _saveTokens.apply(this, arguments);\n}\n\nfunction _saveTokens() {\n  _saveTokens = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(params) {\n    var access_token, decoded, expires_in, type, expires_at;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            //console.log(\"saveTokens params\", params);\n            access_token = params.access_token, decoded = params.decoded;\n            expires_in = decoded.expires_in, type = decoded.type;\n            expires_at = new Date();\n            expires_at.setSeconds(expires_at.getSeconds() + expires_in);\n            _context4.next = 7;\n            return asyncLocalStorage.setItem(config.AUTH_IN, expires_in);\n\n          case 7:\n            _context4.next = 9;\n            return asyncLocalStorage.setItem(config.AUTH_AT, expires_at.getTime());\n\n          case 9:\n            _context4.next = 11;\n            return asyncLocalStorage.setItem(config.AUTH_TOKEN, access_token);\n\n          case 11:\n            _context4.next = 13;\n            return asyncLocalStorage.setItem(config.AUTH_TYPE, type);\n\n          case 13:\n            return _context4.abrupt(\"return\", Promise.resolve(true));\n\n          case 16:\n            _context4.prev = 16;\n            _context4.t0 = _context4[\"catch\"](0);\n            throw _context4.t0;\n\n          case 19:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[0, 16]]);\n  }));\n  return _saveTokens.apply(this, arguments);\n}","map":null,"metadata":{},"sourceType":"module"}