{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Row, Col, Typography, Button, Table, message, Drawer } from \"antd\";\nimport React from \"react\";\nimport { HomeFilled, ClockCircleOutlined, InfoCircleFilled, DeleteFilled } from \"@ant-design/icons\";\nimport { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport Link from \"next/link\";\nimport { asyncLocalStorage } from \"../../../utils/localStorage\";\nimport { getPlateByID } from \"../../../redux/actions/food\";\nimport { getUserBasket, increaseItemToCart, decreaseItemToCart, removeInCart } from \"../../../redux/actions/cart/cartAction\";\nimport { VscLoading } from \"react-icons/vsc\";\nimport { session, useSession } from \"next-auth/client\";\nimport LoginPage1 from \"../../Layouts/Header/Login/LoginPage1\";\nimport LoginPage2 from \"../../Layouts/Header/Login/LoginPage2\";\nimport { useRouter } from 'next/router';\nvar Text = Typography.Text;\n\nvar ClockIcon = function ClockIcon() {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/clock.png\",\n    className: \"w-3 h-3\",\n    alt: \"clock\"\n  });\n};\n\nvar TruckIcon = function TruckIcon() {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/truck.png\",\n    alt: \"truck\",\n    className: \"h-3 w-auto\"\n  });\n};\n\nvar CartIcon = function CartIcon() {\n  return /*#__PURE__*/_jsx(\"img\", {\n    src: \"/images/cart.png\",\n    alt: \"cart\",\n    className: \"w-4 h-4\"\n  });\n};\n\nvar StarIcon = function StarIcon() {\n  return /*#__PURE__*/_jsx(\"img\", {\n    className: \"w-3 h-3\",\n    src: \"/images/star-yellow.png\",\n    alt: \"rating\"\n  });\n};\n\nvar Item = function Item(_ref) {\n  var price = _ref.price,\n      name = _ref.name,\n      orderCount = _ref.orderCount,\n      plateID = _ref.plateID,\n      basketItemId = _ref.basketItemId;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 2),\n      session = _useSession2[0],\n      loading = _useSession2[1];\n\n  var dispatch = useDispatch();\n\n  var _useState = useState(orderCount),\n      quantity = _useState[0],\n      setQuantity = _useState[1];\n\n  var router = useRouter();\n  console.log(\"router\");\n  console.log(router.pathname);\n\n  var updateDOM = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(basketItemId, plateId, type) {\n      var cartitems, deliveryType;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return asyncLocalStorage.getItem(\"cartitems\");\n\n            case 2:\n              cartitems = _context.sent;\n              cartitems = JSON.parse(cartitems)[\"items\"];\n\n              if (!(cartitems.length > 0)) {\n                _context.next = 20;\n                break;\n              }\n\n              cartitems.forEach(function (item) {\n                if (item[\"plateId\"] == plateId) {\n                  console.log(\"found\");\n\n                  if (type === \"add\") {\n                    item[\"ordered\"] = item[\"ordered\"] + 1;\n                  } else {\n                    item[\"ordered\"] = item[\"ordered\"] - 1;\n                  }\n\n                  console.log(item);\n                }\n              });\n              console.log(cartitems);\n              _context.next = 9;\n              return asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n                items: cartitems\n              }));\n\n            case 9:\n              console.log(\"items set\");\n\n              if (!session) {\n                _context.next = 19;\n                break;\n              }\n\n              deliveryType = \"user\";\n\n              if (!(type === \"add\")) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 15;\n              return dispatch(increaseItemToCart(basketItemId, deliveryType));\n\n            case 15:\n              _context.next = 19;\n              break;\n\n            case 17:\n              _context.next = 19;\n              return dispatch(decreaseItemToCart(basketItemId, deliveryType));\n\n            case 19:\n              window.location.reload();\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function updateDOM(_x, _x2, _x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var AddOne = function AddOne(basketItemId, plateID) {\n    console.log(\"AddOne\");\n    console.log(quantity);\n\n    if (quantity < 10) {\n      setQuantity(quantity + 1);\n      updateDOM(basketItemId, plateID, \"add\");\n    }\n  };\n\n  var removeOne = function removeOne(basketItemId, plateID) {\n    console.log(\"removeOne\");\n    console.log(quantity);\n\n    if (quantity > 1) {\n      setQuantity(quantity - 1);\n      updateDOM(basketItemId, plateID, \"remove\");\n    }\n  };\n\n  var removeItemInCart = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(basketItemId, plateID) {\n      var deliveryType, cartitems;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              deliveryType = \"user\";\n              _context2.next = 3;\n              return dispatch(removeInCart(basketItemId, deliveryType, plateID));\n\n            case 3:\n              _context2.next = 5;\n              return asyncLocalStorage.getItem(\"cartitems\");\n\n            case 5:\n              cartitems = _context2.sent;\n              cartitems = JSON.parse(cartitems)[\"items\"];\n              cartitems = cartitems.filter(function (e) {\n                return e.plateId.toString() !== plateID.toString();\n              });\n\n              if (!(cartitems.length > 0)) {\n                _context2.next = 13;\n                break;\n              }\n\n              _context2.next = 11;\n              return asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n                items: cartitems\n              }));\n\n            case 11:\n              _context2.next = 15;\n              break;\n\n            case 13:\n              _context2.next = 15;\n              return asyncLocalStorage.removeItem(\"cartitems\");\n\n            case 15:\n              // setCartData(cartitems);\n              window.location.reload();\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function removeItemInCart(_x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsxs(Row, {\n      gutter: 2,\n      className: \"py-4 px-2 items-center\",\n      children: [/*#__PURE__*/_jsxs(Col, {\n        span: 16,\n        className: \"flex items-center\",\n        children: [/*#__PURE__*/_jsx(DeleteFilled, {\n          onClick: function onClick() {\n            return removeItemInCart(basketItemId, plateID);\n          },\n          className: \"mr-3 text-lg pb-1 cursor-pointer\"\n        }), /*#__PURE__*/_jsx(\"p\", {\n          children: name\n        })]\n      }), /*#__PURE__*/_jsx(Col, {\n        md: 3,\n        lg: 2,\n        span: 4,\n        className: \"lg:ml-auto py-1 border-b-2 border-gray-400 bg-gray-300\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center justify-center\",\n          children: [/*#__PURE__*/_jsx(\"button\", {\n            onClick: function onClick() {\n              return AddOne(basketItemId, plateID);\n            },\n            children: \"+\"\n          }), /*#__PURE__*/_jsx(\"p\", {\n            className: \"mx-2\",\n            children: orderCount\n          }), /*#__PURE__*/_jsx(\"button\", {\n            onClick: function onClick() {\n              return removeOne(basketItemId, plateID);\n            },\n            children: \"-\"\n          })]\n        })\n      }), /*#__PURE__*/_jsxs(Col, {\n        span: 2,\n        className: \"text-right ml-auto\",\n        children: [\"$ \", price]\n      })]\n    })]\n  });\n};\n\nfunction Cart() {\n  var _useSession3 = useSession(),\n      _useSession4 = _slicedToArray(_useSession3, 2),\n      session = _useSession4[0],\n      loading = _useSession4[1];\n\n  var dispatch = useDispatch();\n\n  var _useState2 = useState([]),\n      data = _useState2[0],\n      setData = _useState2[1];\n\n  var _useState3 = useState(false),\n      isCart = _useState3[0],\n      setisCart = _useState3[1];\n\n  var _useState4 = useState(false),\n      sessionFlag = _useState4[0],\n      setSessionFlag = _useState4[1];\n\n  var _useState5 = useState(0.0),\n      total = _useState5[0],\n      setTotal = _useState5[1];\n\n  var _useState6 = useState(false),\n      isMobile = _useState6[0],\n      setIsMobile = _useState6[1];\n\n  var _useState7 = useState(false),\n      visible = _useState7[0],\n      setVisible = _useState7[1];\n\n  var _useState8 = useState({\n    customer: \"\",\n    page1: true,\n    page2: false\n  }),\n      state = _useState8[0],\n      setState = _useState8[1];\n\n  var moveToPage2 = function moveToPage2() {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      page1: false,\n      page2: true\n    }));\n  };\n\n  var goToPage1 = function goToPage1() {\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      page1: true,\n      page2: false\n    }));\n  };\n\n  var onClose = function onClose() {\n    setTimeout(function () {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        page1: true,\n        page2: false\n      }));\n    }, 500);\n    setVisible(false);\n  };\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var cartitems, deliveryType, basketData, _loop, itemKey;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            window.screen.width < 780 ? setIsMobile(true) : setIsMobile(false);\n\n            if (isCart) {\n              _context4.next = 26;\n              break;\n            }\n\n            _context4.next = 4;\n            return asyncLocalStorage.getItem(\"cartitems\");\n\n          case 4:\n            cartitems = _context4.sent;\n            cartitems = JSON.parse(cartitems);\n\n            if (!cartitems) {\n              _context4.next = 25;\n              break;\n            }\n\n            deliveryType = \"user\"; //get basket items here\n\n            if (!session) {\n              _context4.next = 17;\n              break;\n            }\n\n            _context4.next = 11;\n            return dispatch(getUserBasket(deliveryType));\n\n          case 11:\n            basketData = _context4.sent;\n            setData(function (data) {\n              return basketData.items;\n            });\n            setTotal(function (total) {\n              return basketData.total;\n            });\n            setSessionFlag(true);\n            _context4.next = 25;\n            break;\n\n          case 17:\n            _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop(itemKey) {\n              var item, plateId, plateData, plateDataToPush;\n              return _regeneratorRuntime.wrap(function _loop$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      item = cartitems[\"items\"][itemKey];\n                      plateId = item[\"plateId\"];\n                      _context3.next = 4;\n                      return dispatch(getPlateByID(plateId));\n\n                    case 4:\n                      plateData = _context3.sent;\n                      plateDataToPush = {\n                        plate_id: plateId,\n                        count: item[\"ordered\"],\n                        plate_name: plateData.data.name,\n                        plate_price: (plateData.data.price * item[\"ordered\"]).toFixed(2)\n                      };\n                      console.log(\"Pushded\", plateDataToPush); // console.log(data)\n\n                      console.log(total + plateData.data.price * item[\"ordered\"]);\n                      setTotal(function (total) {\n                        return total + plateData.data.price * item[\"ordered\"];\n                      });\n                      setData(function (data) {\n                        return [].concat(_toConsumableArray(data), [plateDataToPush]);\n                      });\n\n                    case 10:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _loop);\n            });\n            _context4.t0 = _regeneratorRuntime.keys(cartitems[\"items\"]);\n\n          case 19:\n            if ((_context4.t1 = _context4.t0()).done) {\n              _context4.next = 24;\n              break;\n            }\n\n            itemKey = _context4.t1.value;\n            return _context4.delegateYield(_loop(itemKey), \"t2\", 22);\n\n          case 22:\n            _context4.next = 19;\n            break;\n\n          case 24:\n            setSessionFlag(false);\n\n          case 25:\n            setisCart(true);\n\n          case 26:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee3);\n  })), []);\n\n  var setCartData = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(cartitems) {\n      var _loop2, itemKey;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _loop2 = /*#__PURE__*/_regeneratorRuntime.mark(function _loop2(itemKey) {\n                var item, plateId, plateData, plateDataToPush;\n                return _regeneratorRuntime.wrap(function _loop2$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        item = cartitems[\"items\"][itemKey];\n                        plateId = item[\"plateId\"];\n                        _context5.next = 4;\n                        return dispatch(getPlateByID(plateId));\n\n                      case 4:\n                        plateData = _context5.sent;\n                        plateDataToPush = {\n                          plate_id: plateId,\n                          count: item[\"ordered\"],\n                          plate_name: plateData.data.name,\n                          plate_price: (plateData.data.price * item[\"ordered\"]).toFixed(2)\n                        };\n                        console.log(\"Pushded\", plateDataToPush); // console.log(data)\n\n                        console.log(total + plateData.data.price * item[\"ordered\"]);\n                        setTotal(function (total) {\n                          return total + plateData.data.price * item[\"ordered\"];\n                        });\n                        setData(function (data) {\n                          return [].concat(_toConsumableArray(data), [plateDataToPush]);\n                        });\n\n                      case 10:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _loop2);\n              });\n              _context6.t0 = _regeneratorRuntime.keys(cartitems[\"items\"]);\n\n            case 2:\n              if ((_context6.t1 = _context6.t0()).done) {\n                _context6.next = 7;\n                break;\n              }\n\n              itemKey = _context6.t1.value;\n              return _context6.delegateYield(_loop2(itemKey), \"t2\", 5);\n\n            case 5:\n              _context6.next = 2;\n              break;\n\n            case 7:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function setCartData(_x6) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"cart-banner\",\n      children: [/*#__PURE__*/_jsx(Row, {\n        className: \"mt-20 pt-2 pb-4 mx-auto w-3/5\",\n        align: \"middle\",\n        children: /*#__PURE__*/_jsxs(Col, {\n          span: 24,\n          className: \"flex justify-start items-center\",\n          children: [/*#__PURE__*/_jsx(HomeFilled, {}), /*#__PURE__*/_jsx(Text, {\n            strong: true,\n            className: \"text-black ml-4\",\n            children: \"Cart\"\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"w-full bg-fixed bg-cover bg-no-repeat bg-center relative\",\n        style: {\n          backgroundImage: \"url(/images/cartbg.jpg)\",\n          height: \"40vh\",\n          backgroundSize: \"100%\",\n          filter: \"brightness(50%)\"\n        },\n        justify: \"center\",\n        align: \"middle\"\n      }), /*#__PURE__*/_jsx(Row, {\n        className: \"absolute w-full\",\n        style: {\n          height: \"40vh\",\n          transform: \"translateY(-100%)\"\n        },\n        justify: \"center\",\n        align: \"middle\",\n        children: /*#__PURE__*/_jsx(Col, {\n          children: /*#__PURE__*/_jsx(Text, {\n            strong: true,\n            className: \"block text-white text-3xl\",\n            children: \"Cart\"\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"cart-main lg:px-36 md:px-20 px-2 py-20\",\n      children: [/*#__PURE__*/_jsx(Text, {\n        className: \"lg:px-36 md:px-20 px-2 text-2xl\",\n        strong: true,\n        children: \"Items\"\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"lg:px-36 md:px-20 px-2 py-4\",\n        children: isCart === true && data.length > 0 ? /*#__PURE__*/_jsxs(_Fragment, {\n          children: [session && sessionFlag ? /*#__PURE__*/_jsx(_Fragment, {\n            children: data.map(function (basket, index) {\n              return /*#__PURE__*/_jsx(Item, {\n                basketItemId: basket.basketItemId,\n                plateID: basket.plate.id,\n                name: basket.plate.name,\n                price: basket.total_value,\n                orderCount: basket.quantity\n              }, index);\n            })\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: data.map(function (plate_data, index) {\n              return /*#__PURE__*/_jsx(Item, {\n                plateID: plate_data[\"plate_id\"],\n                name: plate_data[\"plate_name\"],\n                price: plate_data[\"plate_price\"],\n                orderCount: plate_data[\"count\"]\n              }, index);\n            })\n          }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsx(\"div\", {\n            className: \"py-4 cart-info \",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex cart-info justify-between pt-1\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"cart-total order-last\",\n                children: /*#__PURE__*/_jsxs(\"p\", {\n                  className: \"font-semibold text-base\",\n                  children: [\"$\", total]\n                })\n              }), /*#__PURE__*/_jsxs(\"span\", {\n                className: \"font-semibold text-lg\",\n                children: [\"Subtotal\", /*#__PURE__*/_jsxs(\"p\", {\n                  className: \"flex items-center text-xs\",\n                  children: [/*#__PURE__*/_jsx(InfoCircleFilled, {\n                    className: \"mr-1 text-red-500\"\n                  }), \" Extra charges may apply\"]\n                })]\n              })]\n            })\n          }), session ? /*#__PURE__*/_jsx(_Fragment, {\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"flex flex-row-reverse checkout-btn\",\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: \"py-4 px-10 text-center bg-red-500 text-white font-semibold\",\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/payments\",\n                  children: /*#__PURE__*/_jsx(\"a\", {\n                    children: \" Checkout \\u2192\"\n                  })\n                })\n              })\n            })\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"flex flex-row-reverse checkout-btn\",\n              onClick: function onClick() {\n                return setVisible(true);\n              },\n              children: /*#__PURE__*/_jsx(\"p\", {\n                className: \"py-4 px-10 text-center bg-red-500 text-white font-semibold\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \" Checkout \\u2192\"\n                })\n              })\n            })\n          }), /*#__PURE__*/_jsxs(Drawer, {\n            destroyOnClose: true,\n            placement: \"left\",\n            closable: false,\n            onClose: onClose,\n            visible: visible,\n            width: isMobile ? \"100%\" : \"35%\",\n            drawerStyle: {\n              width: \"83%\",\n              marginLeft: \"auto\",\n              marginRight: \"auto\"\n            },\n            keyboard: true,\n            children: [state.page1 && /*#__PURE__*/_jsx(LoginPage1, {\n              onClick: function onClick() {\n                return setVisible(false);\n              },\n              onPartnerSignInClick: moveToPage2,\n              onUserSignInClick: moveToPage2\n            }), state.page2 && /*#__PURE__*/_jsx(LoginPage2, {\n              onClick: onClose,\n              goBack: goToPage1,\n              customer: state.customer\n            })]\n          })]\n        }) : /*#__PURE__*/_jsx(_Fragment, {\n          children: isCart && data.length < 1 ? /*#__PURE__*/_jsxs(\"p\", {\n            className: \"text-center text-3xl py-6\",\n            children: [\"Your Cart is empty\", /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"a\", {\n                className: \"block text-xl pt-4\",\n                children: \"Goto Home \\u2192\"\n              })\n            })]\n          }) : /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex pt-20 flex-col items-center justify-center\",\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: \"text-3xl\",\n              children: \"Loading\"\n            }), /*#__PURE__*/_jsx(VscLoading, {\n              className: \"text-4xl animate-spin\"\n            })]\n          })\n        })\n      })]\n    })]\n  });\n}\n\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}