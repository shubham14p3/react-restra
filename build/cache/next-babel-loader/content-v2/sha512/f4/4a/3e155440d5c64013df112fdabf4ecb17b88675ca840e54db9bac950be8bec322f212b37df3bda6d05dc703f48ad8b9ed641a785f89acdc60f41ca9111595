{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { Component, useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { Menu, Dropdown, Button, Drawer, Badge } from \"antd\";\nimport { signOut, useSession } from \"next-auth/client\";\nimport { DownOutlined } from \"@ant-design/icons\";\nimport { FaUser } from \"react-icons/fa\";\nimport Signup from \"./Signup/Signup\";\nimport Login from \"./Login/Login\";\nimport LeftMenu from \"../menu/LeftMenu\";\nimport { FaShoppingBag } from \"react-icons/fa\";\nimport { asyncLocalStorage } from \"../../../utils/localStorage\";\nimport { useLocalStorageState } from \"ahooks\";\nimport { connect, useSelector, useDispatch } from \"react-redux\";\nimport { setCartItems, setCartItemsWithSessionFlag, setCartItemsWithoutSessionFlag, getUserBasket, addItemsToCart } from \"../../../redux/actions/cart/cartAction\";\nimport PredictionsOnInputChange from \"../../auto-complete/index\";\n\nconst FoodHeader = ({\n  cart\n}) => {\n  const [session, loading] = useSession();\n  const {\n    0: searchValue,\n    1: setSearchValue\n  } = useState(\"\");\n  const {\n    0: cartCount,\n    1: setCartCount\n  } = useState(0);\n  const {\n    0: basketItems,\n    1: setBasketItems\n  } = useState([]);\n  const isChef = (session === null || session === void 0 ? void 0 : session.role) === \"chef\";\n  const isDriver = (session === null || session === void 0 ? void 0 : session.role) === \"driver\";\n  const isUser = (session === null || session === void 0 ? void 0 : session.role) === \"user\";\n  const [items, setItems] = useLocalStorageState(\"cartitems\");\n  const dispatch = useDispatch();\n  useEffect(async () => {\n    try {\n      console.log(\"SESSION: ==>>\");\n      console.log(session);\n      let localBasketItems = items ? items[\"items\"] : [];\n      let platesArray = [];\n      let cartItemsArray = [];\n      let deliveryType = \"user\";\n\n      if (session) {\n        if (!cart.cartItemSetWithSessionFlag) {\n          console.log(\"1\");\n          let userBasketItemsBefore = await dispatch(getUserBasket(deliveryType)); //\n\n          localBasketItems.map(item => {\n            console.log(\"2\");\n\n            if (!userBasketItemsBefore.items.some(basket => basket.plate.id.toString() === item.plateId.toString())) {\n              console.log(\"not match: \" + item.plateId);\n              platesArray.push({\n                quantity: 1,\n                plateId: item.plateId,\n                note: \"Special Instructions goes here\"\n              });\n            }\n          });\n          console.log(\"3\");\n\n          if (platesArray.length > 0) {\n            let reqBasket = {\n              deliveryType: \"user\",\n              plates: platesArray\n            };\n            console.log(\"4\");\n            await dispatch(addItemsToCart(reqBasket));\n          } // get user basket items\n\n\n          let userBasketItemsAfter = await dispatch(getUserBasket(deliveryType));\n          console.log(\"5\");\n          console.log(userBasketItemsAfter); // if both basket is not empty\n\n          userBasketItemsAfter.items.map(item => {\n            console.log(\"6\");\n            cartItemsArray.push({\n              ordered: item.quantity,\n              plateId: item.plate.id\n            });\n          });\n          console.log(\"7\");\n          await asyncLocalStorage.setItem(\"cartitems\", JSON.stringify({\n            items: cartItemsArray\n          }));\n          dispatch(setCartItems(cartItemsArray));\n          dispatch(setCartItemsWithSessionFlag());\n          console.log(\"8\");\n        }\n      } else {\n        if (!cart.cartItemSetWithoutSessionFlag) {\n          dispatch(setCartItems(localBasketItems));\n          dispatch(setCartItemsWithoutSessionFlag());\n        }\n      }\n\n      console.log(\"9\");\n      setCartCount(cart.itemCount);\n    } catch (e) {\n      console.log(e);\n    }\n  }, [cart, session]);\n\n  const DropdownMobile = () => {\n    return /*#__PURE__*/_jsxs(Menu, {\n      className: \"mt-4\",\n      children: [/*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: !session ? /*#__PURE__*/_jsx(Signup, {\n          isMobile: true\n        }) : /*#__PURE__*/_jsx(Link, {\n          href: `${isChef ? \"/chef\" : isDriver ? \"/driver\" : \"/user\"}`,\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Dashboard\"\n          })\n        })\n      }, \"0\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: !session ? /*#__PURE__*/_jsx(Login, {\n          isMobile: true\n        }) : /*#__PURE__*/_jsx(Link, {\n          href: `${isChef ? \"/chef/profile\" : isDriver ? \"/driver/profile\" : \"/user/profile\"}`,\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-8 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Profile\"\n          })\n        })\n      }, \"1\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/about\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n            children: \"About\"\n          })\n        })\n      }, \"2\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/contact\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n            children: \"Contact us\"\n          })\n        })\n      }, \"3\"), /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/cart\",\n          children: /*#__PURE__*/_jsxs(\"p\", {\n            className: \"cursor-pointer flex items-center\",\n            children: [\"Cart (\", cartCount, \")\"]\n          })\n        })\n      }, \"4\"), session ? /*#__PURE__*/_jsx(Menu.Item, {\n        className: \"py-6 px-8\",\n        children: /*#__PURE__*/_jsx(\"a\", {\n          href: \"#\",\n          className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n          role: \"menuitem\",\n          onClick: e => {\n            e.preventDefault();\n            signOut({\n              callbackUrl: \"/\"\n            });\n          },\n          children: \"Sign out\"\n        })\n      }, \"4\") : null]\n    });\n  };\n\n  const ImgIcon = () => {\n    // console.log(session.user.image)\n    if (session.user.image == \"null\") {\n      return /*#__PURE__*/_jsx(FaUser, {\n        className: \"text-2xl h-8 w-8 rounded-full mr-2\"\n      });\n    } else {\n      return /*#__PURE__*/_jsx(\"img\", {\n        src: session.user.image,\n        className: \"user-img h-8 w-8 rounded-full mr-6\",\n        alt: \"\"\n      });\n    }\n\n    return /*#__PURE__*/_jsx(FaUser, {});\n  };\n\n  const DropdownMenu = () => {\n    return /*#__PURE__*/_jsxs(Menu, {\n      className: \"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5\",\n      children: [/*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(Link, {\n          href: `${isChef ? \"/chef\" : isDriver ? \"/driver\" : \"/#\"}`,\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Dashboard\"\n          })\n        })\n      }, \"0\"), /*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(Link, {\n          href: `${isChef ? \"/chef/profile\" : isDriver ? \"/driver/profile\" : \"/user/profile\"}`,\n          children: /*#__PURE__*/_jsx(\"a\", {\n            href: \"#\",\n            className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n            role: \"menuitem\",\n            children: \"Profile\"\n          })\n        })\n      }, \"1\"), /*#__PURE__*/_jsx(Menu.Item, {\n        children: /*#__PURE__*/_jsx(\"a\", {\n          href: \"#\",\n          className: \"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\",\n          role: \"menuitem\",\n          onClick: e => {\n            e.preventDefault();\n            signOut({\n              callbackUrl: \"/\"\n            });\n          },\n          children: \"Sign out\"\n        })\n      }, \"2\")]\n    });\n  };\n\n  return session ? /*#__PURE__*/_jsx(\"nav\", {\n    style: {\n      backgroundColor: \"#F7FCFF\",\n      boxShadow: \"0 0 5px #ddd\"\n    },\n    className: \"dark:bg-gray-800 stickey\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"mx-auto py-4\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:flex md:items-center md:justify-between\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex justify-between items-center px-8 md:px-0\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:block\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:flex cursor-pointer red pl-12\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"md:hidden cursor-pointer red\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/mobile-logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex md:hidden\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex flex-col -mx-4 md:flex-row md:items-center md:mx-8\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/about\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \"About\"\n                })\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"/contact\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n                  children: \"Contact us\"\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"mr-32 w-52\",\n              children: /*#__PURE__*/_jsx(PredictionsOnInputChange, {\n                searchValue: searchValue,\n                setSearchValue: e => setSearchValue(e),\n                onChange: value => {\n                  setSearchValue(value);\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex items-center\",\n              children: [/*#__PURE__*/_jsx(Badge, {\n                count: cartCount,\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/cart\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: \"cursor-pointer flex items-center\",\n                    children: /*#__PURE__*/_jsx(FaShoppingBag, {\n                      className: \"text-2xl\"\n                    })\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Dropdown, {\n                className: \"flex flex-row justify-center items-center mt-4 md:mt-0\",\n                overlay: DropdownMenu,\n                trigger: [\"click\"],\n                placement: \"bottomRight\",\n                children: /*#__PURE__*/_jsxs(Button, {\n                  style: {\n                    backgroundColor: \"transparent\"\n                  },\n                  className: \"px-6 flex flex-row justify-center items-center\",\n                  type: \"text\",\n                  icon: /*#__PURE__*/_jsx(ImgIcon, {}),\n                  children: [session.user.name, \" \", /*#__PURE__*/_jsx(DownOutlined, {\n                    className: \"ml-2\"\n                  })]\n                })\n              })]\n            })]\n          })\n        })]\n      })\n    })\n  }) : /*#__PURE__*/_jsx(\"nav\", {\n    style: {\n      backgroundColor: \"#F7FCFF\",\n      boxShadow: \"0 0 5px #ddd\"\n    },\n    className: \"dark:bg-gray-800 stickey\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"mx-auto py-4\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:flex md:items-center md:justify-between\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex justify-between items-center px-8 md:px-0\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:block\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"hidden md:flex cursor-pointer red pl-8\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"md:hidden cursor-pointer red\",\n            children: /*#__PURE__*/_jsx(Link, {\n              href: \"/\",\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/images/mobile-logo.png\"\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex md:hidden\",\n            children: /*#__PURE__*/_jsx(LeftMenu, {})\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"hidden md:flex md:items-center md:justify-between flex-1\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex flex-col -mx-4 md:flex-row md:items-center md:mx-8\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/about\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  children: \"About\"\n                })\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"/contact\",\n                children: /*#__PURE__*/_jsx(\"a\", {\n                  className: \"mx-2 mt-2 md:mt-0 px-2 py-1 text-sm rounded-md\",\n                  children: \"Contact us\"\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"mr-32 w-52\",\n              children: /*#__PURE__*/_jsx(PredictionsOnInputChange, {\n                searchValue: searchValue,\n                setSearchValue: e => setSearchValue(e),\n                onChange: value => {\n                  setSearchValue(value);\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex items-center mt-4 md:mt-0\",\n              children: [/*#__PURE__*/_jsx(Badge, {\n                count: cartCount,\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/cart\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    className: \"cursor-pointer\",\n                    children: /*#__PURE__*/_jsx(FaShoppingBag, {\n                      className: \"text-2xl\"\n                    })\n                  })\n                })\n              }), /*#__PURE__*/_jsx(Signup, {}), /*#__PURE__*/_jsx(Login, {})]\n            })]\n          })\n        })]\n      })\n    })\n  });\n};\n\nconst mapToProps = state => {\n  // console.log(state)\n  return {\n    cart: state.cart\n  };\n};\n\nexport default connect(mapToProps)(FoodHeader);","map":null,"metadata":{},"sourceType":"module"}